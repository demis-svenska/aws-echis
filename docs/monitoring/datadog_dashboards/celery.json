{"notify_list":[],"description":"","template_variables":[{"default":"production","prefix":"environment","name":"environment"},{"default":"*","prefix":"celery_queue","name":"celery_queue"},{"default":"*","prefix":"celery_task_name","name":"celery_task"}],"is_read_only":false,"id":"bdu-k5b-bz5","title":"Celery overview","url":"/dashboard/bdu-k5b-bz5/celery-overview","created_at":"2016-06-02T13:47:46.111470+00:00","modified_at":"2019-05-31T13:18:53.677084+00:00","author_handle":"skelly@dimagi.com","widgets":[{"definition":{"autoscale":true,"title":"Celery uptime (for selected range, NOT filtered by queue/task)","custom_unit":"%","precision":2,"requests":[{"q":"avg:network.http.can_connect{$environment,check_type:celery}*100","aggregator":"avg","conditional_formats":[{"palette":"white_on_green","value":99,"comparator":">="},{"palette":"white_on_yellow","value":98,"comparator":">="},{"palette":"white_on_red","value":98,"comparator":"<"}]}],"type":"query_value"},"id":659469628794724},{"definition":{"requests":[{"q":"avg:network.http.can_connect{$environment,check_type:celery} by {environment}","style":{"line_width":"normal","palette":"grey","line_type":"solid"},"display_type":"line"}],"type":"timeseries","events":[{"q":"tags:$environment Deploy Successful ","tags_execution":"and"}],"title":"Celery uptime (NOT filtered by queue/task)"},"id":1447409977947274},{"definition":{"requests":[{"q":"top(avg:commcare.celery.heartbeat.blockage_ok{$environment,$celery_queue} by {celery_queue}*100,50,'mean','asc')","conditional_formats":[{"palette":"white_on_green","value":99,"comparator":">="},{"palette":"white_on_yellow","value":98,"comparator":">="},{"palette":"white_on_red","value":98,"comparator":"<"}],"style":{"palette":"dog_classic"}}],"type":"toplist","title":"Celery uptime by queue (for selected range, NOT filtered by task)"},"id":6968745418127690},{"definition":{"requests":[{"q":"avg:commcare.celery.heartbeat.blockage_ok{$environment,$celery_queue} by {celery_queue,environment}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","events":[{"q":"tags:$environment Deploy Successful ","tags_execution":"and"}],"title":"Celery uptime by queue (NOT filtered by task)"},"id":8015192324715872},{"definition":{"requests":[{"q":"max:commcare.celery.task.time_to_start{$environment,$celery_queue,$celery_task} by {celery_queue}.rollup(max)","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"title":"Time to start (max rollup)","type":"timeseries","events":[{"q":"tags:$environment Deploy Successful ","tags_execution":"and"}],"yaxis":{"include_zero":false,"scale":"sqrt"}},"id":83087048},{"definition":{"requests":[{"q":"max:commcare.celery.heartbeat.blockage_duration{$environment,$celery_queue} by {celery_queue,environment}.rollup(max)","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"title":"Blockage duration by queue (max rollup, NOT filtered by task)","type":"timeseries","yaxis":{"include_zero":false,"scale":"sqrt"}},"id":1399926015352432},{"definition":{"requests":[{"q":"sum:commcare.celery.task.time_to_run{$environment,$celery_queue,$celery_task} by {duration}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}],"title":"Time to run","type":"timeseries","yaxis":{"include_zero":false,"scale":"log"}},"id":7941863544971934},{"definition":{"requests":[{"q":"sum:commcare.celery.task.time_to_run{$environment,$celery_queue,$celery_task} by {host}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}],"title":"Celery tasks by host","type":"timeseries","yaxis":{"include_zero":false}},"id":8961532600818086},{"definition":{"title":"Tasks queued by queue (max rollup, NOT filtered by task)","yaxis":{"include_zero":false,"scale":"sqrt"},"markers":[{"display_type":"warning dashed","value":"y = 100","label":"investigate"}],"requests":[{"q":"sum:celery.tasks_queued{$environment,$celery_queue} by {celery_queue,environment}.rollup(max)","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","events":[{"q":"tags:$environment Deploy Success ","tags_execution":"and"}]},"id":185712938},{"definition":{"requests":[{"q":"top(sum:celery.tasks_completed{$environment,$celery_task,$celery_queue} by {celery_worker,environment}, 50, 'sum', 'desc')","style":{"palette":"dog_classic"}}],"type":"toplist","title":"Tasks completed by worker"},"id":83087047},{"definition":{"requests":[{"q":"per_minute(sum:celery.tasks_by_state.FAILURE{$environment} by {celery_worker})","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}],"type":"timeseries","title":"Tasks failing by worker (NOT filtered by queue/task)"},"id":83087049},{"definition":{"requests":[{"change_type":"absolute","order_dir":"desc","compare_to":"hour_before","q":"avg:celery.tasks_completed{$environment,$celery_queue,$celery_task} by {celery_queue}","show_present":true,"increase_good":true,"order_by":"change"}],"type":"change","title":"Tasks completed this period vs previous period"},"id":83087051},{"definition":{"requests":[{"q":"100-sum:system.mem.pct_usable{group:celery,$environment} by {host}*100","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line","metadata":[{"alias_name":"memory_used","expression":"100-sum:system.mem.pct_usable{group:celery,$environment} by {host}*100"}]}],"title":"Memory overview (% used)","type":"timeseries","events":[{"q":"tags:$environment Deploy Success ","tags_execution":"and"}],"yaxis":{"max":"100"}},"id":181277394},{"definition":{"requests":[{"q":"per_minute(sum:celery.tasks_completed{$environment,$celery_queue,$celery_task})","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","title":"Tasks completed per minute"},"id":265280085},{"definition":{"requests":[{"q":"avg:system.load.norm.5{$environment,group:celery} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","title":"Load average (normalized)"},"id":306371164},{"definition":{"requests":[{"q":"avg:system.mem.used{$environment,group:celery} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:system.mem.total{$environment,group:celery} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"dotted"},"display_type":"line"}],"type":"timeseries","title":"system.mem.used, system.mem.total"},"id":308388933},{"definition":{"requests":[{"q":"avg:system.swap.used{$environment,group:celery} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:system.swap.total{$environment,group:celery} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"dotted"},"display_type":"line"}],"type":"timeseries","title":"system.swap.used, system.swap.total"},"id":308388935},{"definition":{"requests":[{"q":"top(sum:celery.tasks_completed{$environment,$celery_queue,$celery_task} by {celery_queue}, 100, 'sum', 'desc')","style":{"palette":"dog_classic"}}],"type":"toplist","title":"Tasks completed by queue"},"id":376536291},{"definition":{"requests":[{"q":"sum:celery.tasks_by_state.FAILURE{$environment}, sum:celery.tasks_by_state.PENDING{$environment}, sum:celery.tasks_by_state.RECEIVED{$environment}, sum:celery.tasks_by_state.RETRY{$environment}, sum:celery.tasks_by_state.REVOKED{$environment}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"area"}],"type":"timeseries","title":"Tasks by state (failure, pending, recieved, retry, revoked) (NOT filtered by queue/task)"},"id":380224256},{"definition":{"requests":[{"q":"per_minute(sum:celery.tasks_completed{$environment,$celery_task,$celery_queue} by {celery_queue,celery_task_name})","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}],"type":"timeseries","title":"Tasks completed by queue"},"id":395750312},{"definition":{"requests":[{"q":"sum:celery.tasks_by_state.STARTED{$environment} by {celery_worker}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}],"type":"timeseries","title":"Tasks started by worker (NOT filtered by queue/task)"},"id":283202907429294},{"definition":{"requests":[{"q":"avg:rabbitmq.queue.consumer_utilisation{$environment} by {rabbitmq_queue}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"title":"Consumer Utilization by queue (The ratio of time that a queue's consumers can take new messages) (NOT filtered by queue/task)","type":"timeseries","yaxis":{"max":"1","min":"0"}},"id":8716967642546250},{"definition":{"requests":[{"q":"sum:commcare.celery.task.time_to_start_unavailable{$environment,$celery_queue,$celery_task} by {celery_queue}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}],"type":"timeseries","title":"Time to start unavailable (no time_sent found, for debugging time_to_start metric)"},"id":8047307021004264},{"definition":{"requests":[{"q":"sum:commcare.celery.task.time_to_run_unavailable{$environment,$celery_queue,$celery_task} by {celery_queue}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}],"type":"timeseries","title":"Time to run unavailable"},"id":3746380078336570}],"layout_type":"ordered"}
